<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Яндекс Карты - Текущее местоположение и предупреждения о ямах</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=c19294ad-2f6f-4408-b98a-0d12297e7869&lang=ru_RU" type="text/javascript"></script>
    <style>
        #map {
            width: 100%;
            height: 100vh;
        }
        .alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: red;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="alert" class="alert">Внимание! Яма впереди!</div>

    <script>
        // Координаты ям
        const potholes = [
            { lat: 56.756012, lon: 38.089437 },
            { lat: 56.605745, lon: 38.173110 },
            { lat: 56.316636, lon: 38.137599 }
        ];

        // Радиус предупреждения (в метрах)
        const alertRadius = 100;

        let userPosition = null;
        let alertShown = false;

        ymaps.ready(() => {
            const map = new ymaps.Map('map', {
                center: [56.756012, 38.089437],
                zoom: 12
            });

            // Добавление меток для ям
            potholes.forEach(pothole => {
                const placemark = new ymaps.Placemark([pothole.lat, pothole.lon], {
                    hintContent: 'Яма'
                }, {
                    preset: 'islands#redCircleIcon'
                });
                map.geoObjects.add(placemark);
            });

            // Функция для обновления местоположения пользователя
            function updatePosition(position) {
                const coords = [position.coords.latitude, position.coords.longitude];
                if (!userPosition) {
                    userPosition = new ymaps.Placemark(coords, {}, {
                        preset: 'islands#blueCircleIcon'
                    });
                    map.geoObjects.add(userPosition);
                } else {
                    userPosition.geometry.setCoordinates(coords);
                }

                // Проверка расстояния до ям
                checkProximity(coords);

                // Центрирование карты на текущем местоположении
                map.setCenter(coords);
            }

            // Функция для проверки расстояния до ям
            function checkProximity(coords) {
                potholes.forEach(pothole => {
                    const distance = ymaps.coordSystem.geo.getDistance(coords, [pothole.lat, pothole.lon]);
                    if (distance <= alertRadius && !alertShown) {
                        showWarning();
                    } else if (distance > alertRadius && alertShown) {
                        hideWarning();
                    }
                });
            }

            // Функция для отображения предупреждения
            function showWarning() {
                document.getElementById('alert').style.display = 'block';
                alertShown = true;
            }

            // Функция для скрытия предупреждения
            function hideWarning() {
                document.getElementById('alert').style.display = 'none';
                alertShown = false;
            }

            // Получение текущего местоположения
            navigator.geolocation.watchPosition(updatePosition, (error) => {
                console.error('Ошибка при получении местоположения:', error);
            }, {
                enableHighAccuracy: true,
                maximumAge: 0,
                timeout: 5000
            });
        });
    </script>
</body>
</html>